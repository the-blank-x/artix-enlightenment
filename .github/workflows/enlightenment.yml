name: Enlightenment

on:
    push:
        branches:
            - master

jobs:
    build:
        runs-on: ubuntu-latest
        container:
            image: artixlinux/base:latest
            volumes:
                - /out
        steps:
            - name: Setup
              run: |
                cd ~
                # modprobe loop
                pacman -Syu --needed --noconfirm artools base-devel git
                buildiso -p base -q || true
                git clone --depth 1 https://github.com/${{ github.repository }} artools-workspace/iso-profiles
                mkdir -p ~/.config/artools
                cp artools-workspace/iso-profiles/workflow-data/artools-iso.conf ~/.config/artools
                buildiso -p base -q || true

            - uses: actions/upload-artifact@v2
              with:
                name: isos
                path: /out
